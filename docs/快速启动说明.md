# GitHub Global - å¿«é€Ÿå¯åŠ¨è¯´æ˜

æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•å¿«é€Ÿå¯åŠ¨ GitHub Global é¡¹ç›®ã€‚

---

## å‰ç½®è¦æ±‚

åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿å·²å®Œæˆï¼š

1. âœ… [äººå·¥é…ç½®æ–‡æ¡£](./äººå·¥é…ç½®æ–‡æ¡£.md) ä¸­çš„æ‰€æœ‰é…ç½®æ­¥éª¤
2. âœ… å®‰è£… Node.js 20+ å’Œ npm 10+
3. âœ… å®‰è£… MySQL 8.0+
4. âœ… é…ç½®å¥½ `.env` æ–‡ä»¶

---

## æ–¹å¼ä¸€: æœ¬åœ°å¼€å‘å¯åŠ¨

### 1. å®‰è£…ä¾èµ–

```bash
npm install
```

### 2. ç”Ÿæˆ Prisma Client

```bash
npm run db:generate
```

### 3. åˆå§‹åŒ–æ•°æ®åº“

#### æ–¹å¼ A: ä½¿ç”¨ Prisma Migrateï¼ˆæ¨èï¼‰

```bash
npm run db:migrate
```

è¿™ä¼šåˆ›å»ºæ•°æ®åº“è¿ç§»æ–‡ä»¶å¹¶åº”ç”¨åˆ°æ•°æ®åº“ã€‚

#### æ–¹å¼ B: ç›´æ¥æ¨é€ Schema

```bash
npm run db:push
```

è¿™ä¼šç›´æ¥å°† Prisma Schema åŒæ­¥åˆ°æ•°æ®åº“ï¼ˆé€‚åˆå¼€å‘ç¯å¢ƒï¼‰ã€‚

### 4. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
npm run dev
```

### 5. è®¿é—®åº”ç”¨

æ‰“å¼€æµè§ˆå™¨è®¿é—®: http://localhost:3000

---

## æ–¹å¼äºŒ: Docker éƒ¨ç½²

### 1. é…ç½®ç¯å¢ƒå˜é‡

ç¡®ä¿ `.env` æ–‡ä»¶å·²æ­£ç¡®é…ç½®ã€‚

### 2. å¯åŠ¨ Docker Compose

```bash
docker-compose up -d
```

è¿™ä¼šå¯åŠ¨ä¸¤ä¸ªå®¹å™¨ï¼š
- `app`: Next.js åº”ç”¨
- `db`: MySQL æ•°æ®åº“

### 3. è¿è¡Œæ•°æ®åº“è¿ç§»

```bash
docker-compose exec app npx prisma migrate deploy
```

### 4. æŸ¥çœ‹æ—¥å¿—

```bash
docker-compose logs -f app
```

### 5. è®¿é—®åº”ç”¨

æ‰“å¼€æµè§ˆå™¨è®¿é—®: http://localhost:3000

### 6. åœæ­¢æœåŠ¡

```bash
docker-compose down
```

### 7. æ¸…ç†æ•°æ®ï¼ˆå¯é€‰ï¼‰

```bash
docker-compose down -v  # åˆ é™¤æ•°æ®å·
```

---

## éªŒè¯å®‰è£…

### 1. æ£€æŸ¥æ•°æ®åº“è¿æ¥

è®¿é—® Prisma Studio æŸ¥çœ‹æ•°æ®åº“ï¼š

```bash
npm run db:studio
```

è¿™ä¼šæ‰“å¼€ http://localhost:5555ï¼Œå¯ä»¥æŸ¥çœ‹å’Œç¼–è¾‘æ•°æ®åº“å†…å®¹ã€‚

### 2. æ£€æŸ¥ API æ¥å£

è®¿é—®ä»¥ä¸‹æ¥å£æµ‹è¯•ï¼š

- **å¥åº·æ£€æŸ¥**: http://localhost:3000/api/constants/languages
- **æ¨¡å‹åˆ—è¡¨**: http://localhost:3000/api/constants/models

### 3. æµ‹è¯•ç™»å½•æµç¨‹

1. è®¿é—® http://localhost:3000
2. ç‚¹å‡»"ä½¿ç”¨ GitHub ç™»å½•"
3. æˆæƒ GitHub App
4. ç™»å½•æˆåŠŸååº”è¯¥è·³è½¬åˆ°ä»ªè¡¨ç›˜ï¼ˆå¦‚æœæœ‰å‰ç«¯é¡µé¢ï¼‰

---

## å¸¸ç”¨å‘½ä»¤

### å¼€å‘å‘½ä»¤

```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
npm run start

# ä»£ç æ£€æŸ¥
npm run lint
```

### æ•°æ®åº“å‘½ä»¤

```bash
# ç”Ÿæˆ Prisma Client
npm run db:generate

# åˆ›å»ºæ•°æ®åº“è¿ç§»
npm run db:migrate

# ç›´æ¥æ¨é€ Schemaï¼ˆå¼€å‘ç¯å¢ƒï¼‰
npm run db:push

# æ‰“å¼€ Prisma Studio
npm run db:studio
```

### Docker å‘½ä»¤

```bash
# å¯åŠ¨æœåŠ¡
docker-compose up -d

# åœæ­¢æœåŠ¡
docker-compose down

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f app

# é‡æ–°æ„å»ºé•œåƒ
docker-compose build --no-cache

# è¿›å…¥å®¹å™¨
docker-compose exec app sh

# è¿è¡Œæ•°æ®åº“è¿ç§»
docker-compose exec app npx prisma migrate deploy
```

---

## ç›®å½•ç»“æ„

```
github-global/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                      # Next.js App Router é¡µé¢
â”‚   â”‚   â”œâ”€â”€ api/                  # API è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/            # è®¤è¯æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ repos/           # ä»“åº“ç®¡ç†æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ translations/    # ç¿»è¯‘ä»»åŠ¡æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ settings/        # ç”¨æˆ·è®¾ç½®æ¥å£
â”‚   â”‚   â”‚   â””â”€â”€ constants/       # å¸¸é‡æ•°æ®æ¥å£
â”‚   â”‚   â”œâ”€â”€ login/               # ç™»å½•é¡µé¢
â”‚   â”‚   â”œâ”€â”€ layout.tsx           # æ ¹å¸ƒå±€
â”‚   â”‚   â””â”€â”€ page.tsx             # é¦–é¡µ
â”‚   â”œâ”€â”€ lib/                     # æ ¸å¿ƒåº“
â”‚   â”‚   â”œâ”€â”€ github/              # GitHub API å°è£…
â”‚   â”‚   â”œâ”€â”€ openrouter/          # OpenRouter API å°è£…
â”‚   â”‚   â”œâ”€â”€ translation/         # ç¿»è¯‘å¼•æ“
â”‚   â”‚   â”œâ”€â”€ queue/               # ä»»åŠ¡é˜Ÿåˆ—
â”‚   â”‚   â”œâ”€â”€ ratelimit/           # é™æµæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ auth.ts              # NextAuth é…ç½®
â”‚   â”‚   â”œâ”€â”€ db.ts                # Prisma å®¢æˆ·ç«¯
â”‚   â”‚   â””â”€â”€ crypto.ts            # åŠ å¯†å·¥å…·
â”‚   â”œâ”€â”€ config/                  # é…ç½®æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ constants.ts         # å¸¸é‡é…ç½®
â”‚   â””â”€â”€ types/                   # TypeScript ç±»å‹å®šä¹‰
â”œâ”€â”€ prisma/
â”‚   â””â”€â”€ schema.prisma            # æ•°æ®åº“ Schema
â”œâ”€â”€ docs/                        # æ–‡æ¡£
â”‚   â”œâ”€â”€ éœ€æ±‚è§„æ ¼æ–‡æ¡£.md
â”‚   â”œâ”€â”€ æŠ€æœ¯å®ç°æ–¹æ¡ˆæ–‡æ¡£.md
â”‚   â”œâ”€â”€ åç«¯APIæ¥å£æ–‡æ¡£.md
â”‚   â”œâ”€â”€ äººå·¥é…ç½®æ–‡æ¡£.md
â”‚   â””â”€â”€ å¿«é€Ÿå¯åŠ¨è¯´æ˜.md
â”œâ”€â”€ docker-compose.yml           # Docker Compose é…ç½®
â”œâ”€â”€ Dockerfile                   # Docker é•œåƒé…ç½®
â”œâ”€â”€ .env.example                 # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ package.json                 # é¡¹ç›®ä¾èµ–
â””â”€â”€ README.md                    # é¡¹ç›®è¯´æ˜
```

---

## ä½¿ç”¨æµç¨‹

### 1. ç™»å½•ç³»ç»Ÿ

1. è®¿é—® http://localhost:3000
2. ç‚¹å‡»"ä½¿ç”¨ GitHub ç™»å½•"
3. æˆæƒ GitHub App

### 2. å¯¼å…¥ä»“åº“

ä½¿ç”¨ API å¯¼å…¥ä»“åº“ï¼š

```bash
curl -X POST http://localhost:3000/api/repos \
  -H "Content-Type: application/json" \
  -d '{
    "repoUrl": "https://github.com/username/repo-name"
  }'
```

### 3. é…ç½®ç¿»è¯‘

æ›´æ–°ä»“åº“é…ç½®ï¼š

```bash
curl -X PUT http://localhost:3000/api/repos/{repo_id}/config \
  -H "Content-Type: application/json" \
  -d '{
    "baseLanguage": "zh-CN",
    "targetLanguages": ["en", "ja", "ko"]
  }'
```

### 4. åˆ›å»ºç¿»è¯‘ä»»åŠ¡

```bash
curl -X POST http://localhost:3000/api/translations \
  -H "Content-Type: application/json" \
  -d '{
    "repositoryId": "{repo_id}",
    "targetLanguages": ["en", "ja"],
    "type": "FULL"
  }'
```

### 5. æŸ¥çœ‹ç¿»è¯‘è¿›åº¦

ä½¿ç”¨ SSE å®æ—¶è·å–è¿›åº¦ï¼š

```javascript
const eventSource = new EventSource('/api/translations/{task_id}/progress');

eventSource.onmessage = (event) => {
  const data = JSON.parse(event.data);
  console.log('è¿›åº¦:', data.progress);
};
```

### 6. æŸ¥çœ‹ Pull Request

ç¿»è¯‘å®Œæˆåï¼Œä¼šè‡ªåŠ¨åˆ›å»º Pull Requestï¼Œå¯ä»¥åœ¨ GitHub ä»“åº“ä¸­æŸ¥çœ‹å’Œåˆå¹¶ã€‚

---

## æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: ç«¯å£è¢«å ç”¨

**é”™è¯¯**: `Error: listen EADDRINUSE: address already in use :::3000`

**è§£å†³æ–¹æ¡ˆ**:

```bash
# Windows
netstat -ano | findstr :3000
taskkill /PID <PID> /F

# macOS/Linux
lsof -ti:3000 | xargs kill -9
```

### é—®é¢˜ 2: æ•°æ®åº“è¿æ¥å¤±è´¥

**é”™è¯¯**: `Can't reach database server at localhost:3306`

**è§£å†³æ–¹æ¡ˆ**:

1. æ£€æŸ¥ MySQL æ˜¯å¦å¯åŠ¨
2. æ£€æŸ¥ `.env` ä¸­çš„ `DATABASE_URL` é…ç½®
3. æµ‹è¯•æ•°æ®åº“è¿æ¥ï¼š

```bash
mysql -h localhost -u github_global -p
```

### é—®é¢˜ 3: Prisma Client æœªç”Ÿæˆ

**é”™è¯¯**: `Cannot find module '@prisma/client'`

**è§£å†³æ–¹æ¡ˆ**:

```bash
npm run db:generate
```

### é—®é¢˜ 4: GitHub App è®¤è¯å¤±è´¥

**é”™è¯¯**: `Error: Invalid GitHub App credentials`

**è§£å†³æ–¹æ¡ˆ**:

1. æ£€æŸ¥ `.env` ä¸­çš„ GitHub App é…ç½®
2. ç¡®ä¿ç§é’¥æ ¼å¼æ­£ç¡®
3. æ£€æŸ¥ App ID å’Œ Client ID æ˜¯å¦åŒ¹é…

### é—®é¢˜ 5: OpenRouter API è°ƒç”¨å¤±è´¥

**é”™è¯¯**: `401 Unauthorized` æˆ– `429 Rate Limit`

**è§£å†³æ–¹æ¡ˆ**:

1. æ£€æŸ¥ API Key æ˜¯å¦æ­£ç¡®
2. æ£€æŸ¥ OpenRouter è´¦æˆ·ä½™é¢
3. æ£€æŸ¥æ˜¯å¦è¶…è¿‡ API é™æµ

---

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. æ•°æ®åº“ä¼˜åŒ–

- å®šæœŸæ¸…ç†æ—§çš„ç¿»è¯‘ä»»åŠ¡è®°å½•
- ä¸ºå¸¸ç”¨æŸ¥è¯¢æ·»åŠ ç´¢å¼•
- ä½¿ç”¨è¿æ¥æ± 

### 2. ç¿»è¯‘é˜Ÿåˆ—ä¼˜åŒ–

- è°ƒæ•´å¹¶å‘æ•°ï¼ˆé»˜è®¤ 3ï¼‰
- ä½¿ç”¨ Redis æ›¿ä»£æœ¬åœ°é˜Ÿåˆ—ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

### 3. API ç¼“å­˜

- ç¼“å­˜è¯­è¨€åˆ—è¡¨å’Œæ¨¡å‹åˆ—è¡¨
- ç¼“å­˜ä»“åº“æ–‡ä»¶æ ‘ï¼ˆçŸ­æ—¶é—´ï¼‰

---

## ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å»ºè®®

### 1. ç¯å¢ƒå˜é‡

- ä½¿ç”¨ç”Ÿäº§ç¯å¢ƒçš„åŸŸåæ›´æ–° `NEXTAUTH_URL`
- ä½¿ç”¨å¼ºå¯†ç å’Œå¯†é’¥
- ä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç æ•æ„Ÿä¿¡æ¯

### 2. æ•°æ®åº“

- ä½¿ç”¨äº‘æ•°æ®åº“æœåŠ¡ï¼ˆå¦‚ AWS RDSã€é˜¿é‡Œäº‘ RDSï¼‰
- é…ç½®æ•°æ®åº“å¤‡ä»½
- å¯ç”¨ SSL è¿æ¥

### 3. åå‘ä»£ç†

ä½¿ç”¨ Nginx æˆ– Caddy ä½œä¸ºåå‘ä»£ç†ï¼š

```nginx
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
```

### 4. HTTPS

ä½¿ç”¨ Let's Encrypt é…ç½® SSL è¯ä¹¦ï¼š

```bash
certbot --nginx -d your-domain.com
```

### 5. ç›‘æ§å’Œæ—¥å¿—

- é…ç½®æ—¥å¿—æ”¶é›†ï¼ˆå¦‚ Winstonã€Pinoï¼‰
- é…ç½®é”™è¯¯ç›‘æ§ï¼ˆå¦‚ Sentryï¼‰
- é…ç½®æ€§èƒ½ç›‘æ§ï¼ˆå¦‚ New Relicï¼‰

---

## ä¸‹ä¸€æ­¥

é¡¹ç›®å¯åŠ¨æˆåŠŸåï¼Œä½ å¯ä»¥ï¼š

1. ğŸ“– é˜…è¯» [åç«¯APIæ¥å£æ–‡æ¡£](./åç«¯APIæ¥å£æ–‡æ¡£.md) äº†è§£æ‰€æœ‰æ¥å£
2. ğŸ”§ æ ¹æ®éœ€æ±‚è‡ªå®šä¹‰é…ç½®å’ŒåŠŸèƒ½
3. ğŸš€ å¼€å‘å‰ç«¯é¡µé¢ï¼ˆå¦‚æœéœ€è¦ï¼‰
4. ğŸ“Š ç›‘æ§ç¿»è¯‘ä»»åŠ¡æ‰§è¡Œæƒ…å†µ
5. ğŸŒ éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

---

## è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. æŸ¥çœ‹ [å¸¸è§é—®é¢˜](#æ•…éšœæ’æŸ¥)
2. æŸ¥çœ‹é¡¹ç›® Issues
3. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶
4. è”ç³»æŠ€æœ¯æ”¯æŒ

---

ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼ğŸ‰
