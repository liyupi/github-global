# GitHub Global - 简化配置说明

> 本文档提供简化的配置步骤，无需使用 openssl 命令

---

## 1. 创建 GitHub App

### 1.1 访问 GitHub 设置

1. 登录 GitHub
2. 访问 **Settings** > **Developer settings** > **GitHub Apps**
3. 点击 **New GitHub App**

### 1.2 填写基本信息

| 字段 | 值 |
|------|-----|
| **GitHub App name** | `GitHub Global` |
| **Homepage URL** | `http://localhost:3000` |
| **Callback URL** | `http://localhost:3000/api/auth/callback/github` |
| **Webhook** | 取消勾选 "Active"（暂时不需要） |

### 1.3 配置权限

#### Repository Permissions

- **Contents**: Read & Write
- **Metadata**: Read
- **Pull requests**: Read & Write

#### Account Permissions

- **Email addresses**: Read

### 1.4 保存配置

1. 点击 **Create GitHub App**
2. 记录以下信息：
   - **App ID**
   - **Client ID**
3. 点击 **Generate a new client secret**，记录 **Client Secret**
4. 点击 **Generate a private key**，下载私钥文件（.pem 格式）

---

## 2. 配置项目

### 2.1 复制私钥文件

将下载的私钥文件重命名为 `private-key.pem`，放到项目根目录：

```
github-global/
├── private-key.pem  <-- 放在这里
├── src/
├── package.json
└── ...
```

### 2.2 配置环境变量

复制 `.env.example` 为 `.env`：

```bash
cp .env.example .env
```

编辑 `.env` 文件：

```env
# 数据库配置
DATABASE_URL="mysql://root:你的密码@localhost:3306/github_global"

# NextAuth 配置
NEXTAUTH_URL="http://localhost:3000"
NEXTAUTH_SECRET="any-random-string-at-least-32-characters-long-for-session"

# GitHub App 配置
GITHUB_APP_ID="你的App ID"
GITHUB_APP_CLIENT_ID="你的Client ID"
GITHUB_APP_CLIENT_SECRET="你的Client Secret"
GITHUB_APP_PRIVATE_KEY_PATH="./private-key.pem"

# OpenRouter API Key（可选，用于平台托管模式）
PLATFORM_OPENROUTER_API_KEY="sk-or-v1-你的key"
```

**说明**：
- `NEXTAUTH_SECRET`: 随便填写一个至少 32 字符的字符串即可
- `GITHUB_WEBHOOK_SECRET`: 可以不填（已移除）
- 不再需要 `ENCRYPTION_KEY`（已简化为 Base64 编码）

---

## 3. 安装 GitHub App

1. 访问你的 GitHub App 页面
2. 点击 **Install App**
3. 选择要安装的仓库
4. 点击 **Install**

---

## 4. 启动项目

### 4.1 安装依赖

```bash
npm install
```

### 4.2 初始化数据库

```bash
# 生成 Prisma Client
npm run db:generate

# 推送数据库 Schema
npm run db:push
```

### 4.3 启动开发服务器

```bash
npm run dev
```

访问 http://localhost:3000

---

## 5. Docker 部署（可选）

### 5.1 确保私钥文件存在

```
github-global/
├── private-key.pem  <-- 必须存在
├── docker-compose.yml
└── ...
```

### 5.2 启动 Docker

```bash
docker-compose up -d
```

### 5.3 运行数据库迁移

```bash
docker-compose exec app npx prisma migrate deploy
```

---

## 6. 常见问题

### Q1: 如何生成 NEXTAUTH_SECRET？

**答**: 随便输入一个至少 32 字符的字符串即可，例如：

```
NEXTAUTH_SECRET="my-super-secret-key-for-nextauth-session-management-2024"
```

### Q2: 私钥文件放在哪里？

**答**: 放在项目根目录，与 `package.json` 同级：

```
github-global/
├── private-key.pem  <-- 这里
├── package.json
├── src/
└── ...
```

### Q3: 如何获取 GitHub App 私钥？

**答**: 
1. 在 GitHub App 设置页面
2. 滚动到 "Private keys" 部分
3. 点击 "Generate a private key"
4. 下载 `.pem` 文件
5. 重命名为 `private-key.pem` 并放到项目根目录

### Q4: 数据库连接失败？

**答**: 检查 MySQL 是否启动，并确认 `DATABASE_URL` 配置正确：

```bash
# 测试 MySQL 连接
mysql -u root -p

# 创建数据库
CREATE DATABASE github_global;
```

### Q5: 不需要加密存储敏感数据吗？

**答**: 为了快速开发，我们使用了简化的 Base64 编码。生产环境建议使用真正的加密（AES-256）。

---

## 7. 配置检查清单

启动前请确认：

- [ ] 已创建 GitHub App
- [ ] 已下载私钥文件并重命名为 `private-key.pem`
- [ ] 私钥文件放在项目根目录
- [ ] 已配置 `.env` 文件
- [ ] MySQL 已启动
- [ ] 已创建数据库 `github_global`
- [ ] 已安装 GitHub App 到你的账户

---

## 8. 下一步

配置完成后：

1. 启动项目: `npm run dev`
2. 访问: http://localhost:3000
3. 点击"使用 GitHub 登录"
4. 开始使用！

---

**提示**: 如果遇到问题，请查看终端的错误信息，通常会提示缺少哪个配置。
